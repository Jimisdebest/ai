<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slimme Chatbot</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --background-color: #f5f5f5;
            --surface-color: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --primary-color: #6b8cbc;
            --secondary-color: #4a6fa5;
            --background-color: #1a1a1a;
            --surface-color: #2d2d2d;
            --text-color: #f0f0f0;
            --text-secondary: #b0b0b0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: var(--transition);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Header en menu */
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 100;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            margin-right: 15px;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background-color: var(--surface-color);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            z-index: 200;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .menu.open {
            left: 0;
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--text-secondary);
        }

        .menu-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .close-menu {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        .menu-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-icon {
            width: 24px;
            height: 24px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .light-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23333"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM6.34 5.16l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.42-1.42c.39-.39.39-1.02 0-1.41-.38-.39-1.02-.39-1.41 0zm12.73 12.73l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.42-1.42c.39-.39.39-1.02 0-1.41-.38-.39-1.02-.39-1.41 0zM4.93 19.07l1.42-1.42c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.42 1.42c-.39.39-.39 1.02 0 1.41.38.39 1.02.39 1.41 0zm12.73-12.73l1.42-1.42c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.42 1.42c-.39.39-.39-1.02 0-1.41.38-.39 1.02-.39 1.41 0z"/></svg>');
        }

        .dark-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23fff"><path d="M9.37 5.51A7.35 7.35 0 0 0 9.1 7.5c0 4.08 3.32 7.4 7.4 7.4.68 0 1.35-.09 1.99-.27A7.014 7.014 0 0 1 12 19c-3.86 0-7-3.14-7-7 0-2.93 1.81-5.45 4.37-6.49zM12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>');
        }

        /* Chat gebied */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            height: calc(100vh - 70px);
            padding: 20px;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: var(--surface-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease;
            position: relative;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: var(--surface-color);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-bottom-left-radius: 4px;
        }

        .dark-mode .bot-message {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .analysis {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            border-left: 3px solid var(--primary-color);
        }

        .dark-mode .analysis {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 24px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-size: 16px;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .dark-mode .chat-input {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }

        .send-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .send-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        .send-icon {
            width: 24px;
            height: 24px;
            fill: white;
        }

        /* Animaties */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes sendAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .typing-animation {
            overflow: hidden;
            border-right: 2px solid var(--primary-color);
            white-space: nowrap;
            margin: 0 auto;
            animation: typewriter 2s steps(40, end);
        }

        .send-animation {
            animation: sendAnimation 0.3s ease;
        }

        /* Modal voor leerfunctie */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 300;
            align-items: center;
            justify-content: center;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-input {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-size: 16px;
            transition: var(--transition);
        }

        .dark-mode .modal-input {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .modal-textarea {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-size: 16px;
            transition: var(--transition);
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
        }

        .dark-mode .modal-textarea {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .modal-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .modal-section {
            margin: 20px 0;
        }

        .modal-section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .modal-button.cancel {
            background-color: transparent;
            color: var(--text-color);
        }

        .modal-button.save {
            background-color: var(--primary-color);
            color: white;
        }

        .modal-button:hover {
            opacity: 0.9;
        }

        .example-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
            font-style: italic;
        }

        /* Overlay voor menu */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 150;
        }

        .overlay.open {
            display: block;
        }

        /* File input styling */
        .file-input-container {
            margin: 15px 0;
        }

        .file-input-label {
            display: block;
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
        }

        .file-input-label:hover {
            background-color: var(--secondary-color);
        }

        .file-input {
            display: none;
        }

        /* GitHub URL input */
        .github-input-container {
            margin: 15px 0;
        }

        .github-input {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-size: 16px;
            transition: var(--transition);
        }

        .dark-mode .github-input {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .github-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Responsive aanpassingen */
        @media (max-width: 768px) {
            .chat-container {
                padding: 10px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .menu {
                width: 250px;
            }
            
            .modal-content {
                padding: 15px;
            }
        }

        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Chat selectie styling */
        .chat-list {
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .chat-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .chat-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .chat-item.active {
            background-color: var(--primary-color);
            color: white;
        }

        .delete-chat {
            background: none;
            border: none;
            color: #ff4444;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            opacity: 0;
            transition: var(--transition);
        }

        .chat-item:hover .delete-chat {
            opacity: 1;
        }

        .chat-item.active .delete-chat {
            color: white;
        }

        .delete-chat:hover {
            background-color: rgba(255, 68, 68, 0.1);
        }

        /* Keuze knoppen voor leren */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .choice-button {
            padding: 15px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background: none;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-size: 16px;
        }

        .choice-button:hover {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="menu-toggle">‚ò∞</button>
        <h1>Slimme Chatbot</h1>
    </div>

    <div class="overlay"></div>

    <div class="menu">
        <div class="menu-header">
            <div class="menu-title">Menu</div>
            <button class="close-menu">√ó</button>
        </div>
        <div class="menu-item" id="new-chat">
            <span>Nieuwe chat</span>
        </div>
        <div class="menu-item theme-toggle" id="theme-toggle">
            <div class="theme-icon light-icon"></div>
            <span>Donker / Licht modus</span>
        </div>
        <div class="menu-item" id="toggle-analysis">
            <span>Analyse weergeven</span>
        </div>
        <div class="menu-item" id="teach-chatbot">
            <span>Leer de chatbot</span>
        </div>
        
        <div class="menu-section-title" style="margin-top: 20px; font-weight: bold; color: var(--primary-color);">Andere chats</div>
        <div class="chat-list" id="chat-list">
            <!-- Chat items worden hier dynamisch toegevoegd -->
        </div>
    </div>

    <div class="container">
        <div class="chat-container">
            <div class="chat-history" id="chat-history">
                <div class="message bot-message">
                    Hallo! Ik ben je slimme chatbot. Stel me een vraag en ik help je graag!
                </div>
            </div>
            <div class="input-container">
                <input type="text" class="chat-input" id="chat-input" placeholder="Typ je bericht hier...">
                <button class="send-button" id="send-button">
                    <svg class="send-icon" viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="learn-choice-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Hoe wilt u de AI leren?</div>
                <button class="close-modal">√ó</button>
            </div>
            
            <div class="choice-buttons">
                <button class="choice-button" id="single-question-btn">Enkele vraag toevoegen</button>
                <button class="choice-button" id="multiple-questions-btn">Meerdere vragen toevoegen</button>
                <button class="choice-button" id="import-txt-btn">TXT bestand importeren</button>
                <button class="choice-button" id="load-github-btn">Laden van GitHub</button>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancel-learn-choice">Annuleren</button>
            </div>
        </div>
    </div>

    <div class="modal" id="single-question-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Enkele vraag toevoegen</div>
                <button class="close-modal">√ó</button>
            </div>
            
            <p>Dit is mijn vraag:</p>
            <input type="text" class="modal-input" id="teach-question" placeholder="Typ je vraag hier...">
            <p>Dit is het antwoord op die vraag:</p>
            <input type="text" class="modal-input" id="teach-answer" placeholder="Typ het antwoord hier...">
            
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancel-single">Annuleren</button>
                <button class="modal-button save" id="save-single">Opslaan</button>
            </div>
        </div>
    </div>

    <div class="modal" id="multiple-questions-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Meerdere vragen toevoegen</div>
                <button class="close-modal">√ó</button>
            </div>
            
            <p>Voeg meerdere vraag-antwoord paren toe in dit formaat:</p>
            <textarea class="modal-textarea" id="multiple-qa" placeholder="Vraag = Antwoord
Bijvoorbeeld:
Hoe gaat het = Met mij gaat het goed!
Wat is je naam = Ik ben de chatbot!"></textarea>
            <div class="example-text">
                Formaat: elke regel bevat een vraag, gevolgd door " = " en dan het antwoord.
            </div>
            
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancel-multiple">Annuleren</button>
                <button class="modal-button save" id="save-multiple">Opslaan</button>
            </div>
        </div>
    </div>

    <div class="modal" id="import-txt-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">TXT bestand importeren</div>
                <button class="close-modal">√ó</button>
            </div>
            
            <p>Upload een reacties.txt bestand met vraag-antwoord paren in dit formaat:</p>
            <div class="example-text">
                Vraag = Antwoord<br>
                Vraag = Antwoord<br>
                ...
            </div>
            
            <div class="file-input-container">
                <label for="file-input" class="file-input-label">
                    Kies reacties.txt bestand
                </label>
                <input type="file" id="file-input" class="file-input" accept=".txt">
            </div>
            
            <div id="file-content" style="display: none; margin-top: 15px;">
                <div class="modal-section-title">Voorbeeld van ge√Ømporteerde reacties:</div>
                <div id="file-preview" class="modal-textarea" style="min-height: 100px; background-color: rgba(0,0,0,0.05);"></div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancel-import">Annuleren</button>
                <button class="modal-button save" id="save-import" disabled>Importeer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="github-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Laden van GitHub</div>
                <button class="close-modal">√ó</button>
            </div>
            
            <p>Voer de GitHub RAW URL in van het reacties.txt bestand:</p>
            <div class="github-input-container">
                <input type="text" class="github-input" id="github-url" 
                       value="https://raw.githubusercontent.com/jimisdebest/ai/main/reacties.txt">
            </div>
            
            <div class="example-text">
                Standaard wordt geprobeerd: https://raw.githubusercontent.com/jimisdebest/ai/main/reacties.txt
            </div>
            
            <div id="github-status" style="margin-top: 15px;"></div>
            
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancel-github">Annuleren</button>
                <button class="modal-button save" id="load-github">Laden</button>
            </div>
        </div>
    </div>

    <div class="modal" id="save-chat-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Nieuwe chat</div>
                <button class="close-modal">√ó</button>
            </div>
            
            <p>Hoe wilt u de oude chat noemen?</p>
            <input type="text" class="modal-input" id="chat-name" placeholder="Voer chat naam in...">
            
            <div class="modal-buttons">
                <button class="modal-button cancel" id="cancel-save-chat">Annuleren</button>
                <button class="modal-button save" id="save-chat">Opslaan</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementen
            const menuToggle = document.querySelector('.menu-toggle');
            const closeMenu = document.querySelector('.close-menu');
            const menu = document.querySelector('.menu');
            const overlay = document.querySelector('.overlay');
            const themeToggle = document.getElementById('theme-toggle');
            const newChatBtn = document.getElementById('new-chat');
            const toggleAnalysisBtn = document.getElementById('toggle-analysis');
            const teachChatbotBtn = document.getElementById('teach-chatbot');
            const chatList = document.getElementById('chat-list');
            
            // Modal elementen
            const learnChoiceModal = document.getElementById('learn-choice-modal');
            const singleQuestionModal = document.getElementById('single-question-modal');
            const multipleQuestionsModal = document.getElementById('multiple-questions-modal');
            const importTxtModal = document.getElementById('import-txt-modal');
            const githubModal = document.getElementById('github-modal');
            const saveChatModal = document.getElementById('save-chat-modal');
            
            // Keuze knoppen
            const singleQuestionBtn = document.getElementById('single-question-btn');
            const multipleQuestionsBtn = document.getElementById('multiple-questions-btn');
            const importTxtBtn = document.getElementById('import-txt-btn');
            const loadGithubBtn = document.getElementById('load-github-btn');
            
            // Annuleer knoppen
            const cancelLearnChoice = document.getElementById('cancel-learn-choice');
            const cancelSingle = document.getElementById('cancel-single');
            const cancelMultiple = document.getElementById('cancel-multiple');
            const cancelImport = document.getElementById('cancel-import');
            const cancelGithub = document.getElementById('cancel-github');
            const cancelSaveChat = document.getElementById('cancel-save-chat');
            
            // Opslaan knoppen
            const saveSingle = document.getElementById('save-single');
            const saveMultiple = document.getElementById('save-multiple');
            const saveImport = document.getElementById('save-import');
            const loadGithub = document.getElementById('load-github');
            const saveChat = document.getElementById('save-chat');
            
            // Andere elementen
            const fileInput = document.getElementById('file-input');
            const filePreview = document.getElementById('file-preview');
            const fileContent = document.getElementById('file-content');
            const githubUrlInput = document.getElementById('github-url');
            const githubStatus = document.getElementById('github-status');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');
            const chatHistory = document.getElementById('chat-history');
            const chatNameInput = document.getElementById('chat-name');
            
            // Status variabelen
            let isDarkMode = localStorage.getItem('darkMode') === 'true';
            let showAnalysis = localStorage.getItem('showAnalysis') !== 'false';
            let currentChatId = 'current';
            let chats = JSON.parse(localStorage.getItem('chats')) || {};
            let knowledgeBase = JSON.parse(localStorage.getItem('knowledgeBase')) || [];
            let currentFileContent = '';
            
            // Initialiseer de interface
            initializeInterface();
            
            // Functies
            function initializeInterface() {
                // Stel thema in
                if (isDarkMode) {
                    document.body.classList.add('dark-mode');
                    updateThemeIcon(true);
                } else {
                    updateThemeIcon(false);
                }
                
                // Laad knowledge base van GitHub
                loadKnowledgeBaseFromGitHub();
                
                // Laad chats
                loadChats();
                
                // Laad huidige chat
                loadCurrentChat();
                
                // Stel analyseweergave in
                updateAnalysisButton();
            }
            
            async function loadKnowledgeBaseFromGitHub() {
                // Probeer eerst de opgegeven GitHub URL
                const githubUrl = "https://raw.githubusercontent.com/jimisdebest/ai/main/reacties.txt";
                
                try {
                    const response = await fetch(githubUrl);
                    if (response.ok) {
                        const content = await response.text();
                        const result = importFromFile(content);
                        
                        // Toon melding
                        if (result.importedCount > 0) {
                            addMessageToChat(`Automatisch ${result.importedCount} nieuwe reacties geladen van GitHub!`, 'bot');
                            chatHistoryData.push({
                                message: `Automatisch ${result.importedCount} nieuwe reacties geladen van GitHub!`,
                                sender: 'bot',
                                timestamp: new Date().toISOString()
                            });
                        }
                    }
                } catch (error) {
                    console.log('Kon niet laden van GitHub:', error);
                    // Gebruik standaard reacties als backup
                    loadDefaultResponses();
                }
            }
            
            function loadDefaultResponses() {
                const defaultResponses = `Hoe gaat het = Met mij gaat het goed! Hoe gaat het met jou?
Wat is je naam = Ik ben de Slimme Chatbot, aangenaam kennis te maken!
Wat kun je doen = Ik kan vragen beantwoorden, gesprekken voeren en nieuwe dingen leren via het menu.
Hallo = Hallo! Waar wilt u het over hebben?
Hoi = Hoi! Goed je te zien!
Hey = Hey daar!`;
                
                if (knowledgeBase.length === 0) {
                    const defaultQA = parseMultipleQA(defaultResponses);
                    knowledgeBase = defaultQA;
                    localStorage.setItem('knowledgeBase', JSON.stringify(knowledgeBase));
                }
            }
            
            function updateThemeIcon(isDark) {
                const themeIcon = themeToggle.querySelector('.theme-icon');
                if (isDark) {
                    themeIcon.classList.remove('light-icon');
                    themeIcon.classList.add('dark-icon');
                    themeToggle.querySelector('span').textContent = 'Licht modus';
                } else {
                    themeIcon.classList.remove('dark-icon');
                    themeIcon.classList.add('light-icon');
                    themeToggle.querySelector('span').textContent = 'Donker modus';
                }
            }
            
            function updateAnalysisButton() {
                if (showAnalysis) {
                    toggleAnalysisBtn.querySelector('span').textContent = 'Analyse verbergen';
                } else {
                    toggleAnalysisBtn.querySelector('span').textContent = 'Analyse weergeven';
                }
            }
            
            function loadChats() {
                chatList.innerHTML = '';
                
                Object.keys(chats).forEach(chatId => {
                    if (chatId !== 'current') {
                        const chatItem = document.createElement('div');
                        chatItem.classList.add('chat-item');
                        chatItem.innerHTML = `
                            <span>${chats[chatId].name}</span>
                            <button class="delete-chat" data-chatid="${chatId}">üóëÔ∏è</button>
                        `;
                        
                        chatItem.addEventListener('click', function(e) {
                            if (!e.target.classList.contains('delete-chat')) {
                                switchToChat(chatId);
                            }
                        });
                        
                        const deleteBtn = chatItem.querySelector('.delete-chat');
                        deleteBtn.addEventListener('click', function() {
                            deleteChat(chatId);
                        });
                        
                        chatList.appendChild(chatItem);
                    }
                });
            }
            
            function loadCurrentChat() {
                if (!chats[currentChatId]) {
                    chats[currentChatId] = {
                        name: 'Huidige chat',
                        messages: [
                            { message: 'Hallo! Ik ben je slimme chatbot. Stel me een vraag en ik help je graag!', sender: 'bot', timestamp: new Date().toISOString() }
                        ]
                    };
                    localStorage.setItem('chats', JSON.stringify(chats));
                }
                
                renderChatHistory();
            }
            
            function renderChatHistory() {
                chatHistory.innerHTML = '';
                const messages = chats[currentChatId].messages;
                
                messages.forEach(item => {
                    addMessageToChat(item.message, item.sender, item.analysis);
                });
                
                scrollToBottom();
            }
            
            function addMessageToChat(message, sender, analysis = null) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
                
                if (sender === 'bot') {
                    messageDiv.innerHTML = `<div class="typing-animation">${message}</div>`;
                    
                    if (showAnalysis && analysis) {
                        const analysisDiv = document.createElement('div');
                        analysisDiv.classList.add('analysis');
                        analysisDiv.innerHTML = analysis;
                        messageDiv.appendChild(analysisDiv);
                    }
                } else {
                    messageDiv.textContent = message;
                }
                
                chatHistory.appendChild(messageDiv);
                scrollToBottom();
            }
            
            function scrollToBottom() {
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
            
            function processUserMessage(message) {
                // Voeg gebruikersbericht toe aan chat
                addMessageToChat(message, 'user');
                
                // Sla bericht op in huidige chat
                chats[currentChatId].messages.push({
                    message: message,
                    sender: 'user',
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('chats', JSON.stringify(chats));
                
                // Simuleer denktijd
                setTimeout(() => {
                    const response = generateBotResponse(message);
                    addMessageToChat(response.answer, 'bot', response.analysis);
                    
                    // Sla botbericht op in huidige chat
                    chats[currentChatId].messages.push({
                        message: response.answer,
                        sender: 'bot',
                        analysis: showAnalysis ? response.analysis : null,
                        timestamp: new Date().toISOString()
                    });
                    
                    localStorage.setItem('chats', JSON.stringify(chats));
                }, 1000 + Math.random() * 1000);
            }
            
            function generateBotResponse(message) {
                const startTime = Date.now();
                let analysis = '';
                
                // Stap 1: Zoek naar exacte overeenkomst
                analysis += "Zoeken naar exacte overeenkomst...<br>";
                const exactMatch = knowledgeBase.find(item => 
                    item.question.toLowerCase() === message.toLowerCase()
                );
                
                if (exactMatch) {
                    analysis += "<strong>Exacte overeenkomst gevonden. Antwoord geven aan gebruiker.</strong><br>";
                } else {
                    analysis += "Geen exacte overeenkomst gevonden.<br>";
                    
                    // Stap 2: Zoek naar beste overeenkomst
                    analysis += "Zoeken naar vraag met meeste overeenkomst...<br>";
                    const bestMatch = findBestMatch(message);
                    
                    if (bestMatch) {
                        analysis += `Deze vraag is gevonden: "${bestMatch.question}"<br>`;
                        analysis += `Hij heeft ${bestMatch.similarity}% overeenkomst.<br>`;
                        analysis += "<strong>Antwoord geven aan gebruiker.</strong><br>";
                    } else {
                        analysis += "Geen goede overeenkomst gevonden.<br>";
                        analysis += "<strong>Standaard antwoord geven.</strong><br>";
                    }
                }
                
                // Bepaal hoe de vraag wordt opgevat
                if (message.includes('?')) {
                    analysis += "Opgevat als: Vraag<br>";
                } else if (message.trim().length === 0) {
                    analysis += "Opgevat als: Leeg bericht<br>";
                } else {
                    analysis += "Opgevat als: Niet kunnen opvatten<br>";
                }
                
                // Bereken denktijd
                const endTime = Date.now();
                const thinkTime = (endTime - startTime) / 1000;
                analysis += `<br>Totale denktijd: ${thinkTime.toFixed(2)} seconden`;
                
                // Bepaal antwoord
                let answer;
                if (exactMatch) {
                    answer = exactMatch.answer;
                } else {
                    const bestMatch = findBestMatch(message);
                    answer = bestMatch ? bestMatch.answer : getDefaultResponse();
                }
                
                return {
                    answer: answer,
                    analysis: analysis
                };
            }
            
            function findBestMatch(message) {
                let bestMatch = null;
                let highestSimilarity = 0;
                
                const messageWords = message.toLowerCase().split(/\s+/);
                
                knowledgeBase.forEach(item => {
                    const questionWords = item.question.toLowerCase().split(/\s+/);
                    const commonWords = messageWords.filter(word => 
                        questionWords.includes(word) && word.length > 2
                    );
                    
                    const similarity = (commonWords.length / Math.max(messageWords.length, questionWords.length)) * 100;
                    
                    if (similarity > highestSimilarity && similarity > 30) {
                        highestSimilarity = similarity;
                        bestMatch = {
                            question: item.question,
                            answer: item.answer,
                            similarity: Math.round(similarity)
                        };
                    }
                });
                
                return bestMatch;
            }
            
            function getDefaultResponse() {
                const responses = [
                    "Dat is een interessante vraag. Kun je wat meer details geven?",
                    "Hmm, daar heb ik niet direct een antwoord op. Misschien kan ik je op een andere manier helpen?",
                    "Interessant! Ik ben nog aan het leren, dus ik weet hier niet direct het antwoord op.",
                    "Kun je je vraag anders formuleren? Dan kan ik beter helpen."
                ];
                
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            function saveToKnowledgeBase(question, answer) {
                const existingIndex = knowledgeBase.findIndex(item => 
                    item.question.toLowerCase() === question.toLowerCase()
                );
                
                if (existingIndex !== -1) {
                    knowledgeBase[existingIndex].answer = answer;
                } else {
                    knowledgeBase.push({ question, answer });
                }
                
                localStorage.setItem('knowledgeBase', JSON.stringify(knowledgeBase));
                
                // Toon bevestiging
                addMessageToChat(`Bedankt! Ik heb geleerd: "${question}" -> "${answer}"`, 'bot');
                chats[currentChatId].messages.push({
                    message: `Bedankt! Ik heb geleerd: "${question}" -> "${answer}"`,
                    sender: 'bot',
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('chats', JSON.stringify(chats));
            }
            
            function parseMultipleQA(text) {
                const lines = text.split('\n');
                const results = [];
                
                lines.forEach(line => {
                    line = line.trim();
                    if (line && line.includes('=')) {
                        const parts = line.split('=');
                        if (parts.length >= 2) {
                            const question = parts[0].trim();
                            const answer = parts.slice(1).join('=').trim();
                            
                            if (question && answer) {
                                results.push({ question, answer });
                            }
                        }
                    }
                });
                
                return results;
            }
            
            function importFromFile(content) {
                const importedQA = parseMultipleQA(content);
                let importedCount = 0;
                let updatedCount = 0;
                
                importedQA.forEach(qa => {
                    const existingIndex = knowledgeBase.findIndex(item => 
                        item.question.toLowerCase() === qa.question.toLowerCase()
                    );
                    
                    if (existingIndex !== -1) {
                        knowledgeBase[existingIndex].answer = qa.answer;
                        updatedCount++;
                    } else {
                        knowledgeBase.push(qa);
                        importedCount++;
                    }
                });
                
                localStorage.setItem('knowledgeBase', JSON.stringify(knowledgeBase));
                return { importedCount, updatedCount };
            }
            
            async function loadFromGithub(url) {
                try {
                    githubStatus.innerHTML = '<div class="loading"></div> Reacties laden van GitHub...';
                    loadGithub.disabled = true;
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const content = await response.text();
                    const result = importFromFile(content);
                    
                    githubStatus.innerHTML = `<div style="color: green;">‚úÖ Succesvol geladen! ${result.importedCount} nieuwe reacties toegevoegd, ${result.updatedCount} reacties bijgewerkt.</div>`;
                    
                    setTimeout(() => {
                        githubModal.classList.remove('open');
                        overlay.classList.remove('open');
                        
                        addMessageToChat(`GitHub import voltooid! ${result.importedCount} nieuwe reacties toegevoegd, ${result.updatedCount} reacties bijgewerkt.`, 'bot');
                        chats[currentChatId].messages.push({
                            message: `GitHub import voltooid! ${result.importedCount} nieuwe reacties toegevoegd, ${result.updatedCount} reacties bijgewerkt.`,
                            sender: 'bot',
                            timestamp: new Date().toISOString()
                        });
                        
                        localStorage.setItem('chats', JSON.stringify(chats));
                    }, 1500);
                    
                } catch (error) {
                    githubStatus.innerHTML = `<div style="color: red;">‚ùå Fout bij laden: ${error.message}</div>`;
                    loadGithub.disabled = false;
                }
            }
            
            function switchToChat(chatId) {
                // Sla huidige chat op
                localStorage.setItem('chats', JSON.stringify(chats));
                
                // Schakel naar nieuwe chat
                currentChatId = chatId;
                renderChatHistory();
                menu.classList.remove('open');
                overlay.classList.remove('open');
            }
            
            function deleteChat(chatId) {
                if (confirm(`Weet je zeker dat je de chat "${chats[chatId].name}" wilt verwijderen?`)) {
                    delete chats[chatId];
                    localStorage.setItem('chats', JSON.stringify(chats));
                    loadChats();
                    
                    if (currentChatId === chatId) {
                        currentChatId = 'current';
                        loadCurrentChat();
                    }
                }
            }
            
            function startNewChat() {
                if (chats[currentChatId].messages.length > 1) {
                    saveChatModal.classList.add('open');
                } else {
                    resetCurrentChat();
                }
            }
            
            function resetCurrentChat() {
                chats[currentChatId] = {
                    name: 'Huidige chat',
                    messages: [
                        { message: 'Hallo! Ik ben je slimme chatbot. Stel me een vraag en ik help je graag!', sender: 'bot', timestamp: new Date().toISOString() }
                    ]
                };
                localStorage.setItem('chats', JSON.stringify(chats));
                renderChatHistory();
                menu.classList.remove('open');
                overlay.classList.remove('open');
            }
            
            function saveCurrentChat() {
                const chatName = chatNameInput.value.trim();
                if (chatName) {
                    const newChatId = 'chat_' + Date.now();
                    chats[newChatId] = {
                        name: chatName,
                        messages: [...chats[currentChatId].messages]
                    };
                    
                    resetCurrentChat();
                    loadChats();
                    
                    saveChatModal.classList.remove('open');
                    overlay.classList.remove('open');
                    chatNameInput.value = '';
                } else {
                    alert('Voer een naam in voor de chat.');
                }
            }
            
            // Event listeners
            menuToggle.addEventListener('click', function() {
                menu.classList.add('open');
                overlay.classList.add('open');
            });
            
            closeMenu.addEventListener('click', function() {
                menu.classList.remove('open');
                overlay.classList.remove('open');
            });
            
            overlay.addEventListener('click', function() {
                menu.classList.remove('open');
                overlay.classList.remove('open');
                learnChoiceModal.classList.remove('open');
                singleQuestionModal.classList.remove('open');
                multipleQuestionsModal.classList.remove('open');
                importTxtModal.classList.remove('open');
                githubModal.classList.remove('open');
                saveChatModal.classList.remove('open');
            });
            
            themeToggle.addEventListener('click', function() {
                isDarkMode = !isDarkMode;
                document.body.classList.toggle('dark-mode', isDarkMode);
                updateThemeIcon(isDarkMode);
                localStorage.setItem('darkMode', isDarkMode);
            });
            
            newChatBtn.addEventListener('click', function() {
                startNewChat();
                menu.classList.remove('open');
            });
            
            toggleAnalysisBtn.addEventListener('click', function() {
                showAnalysis = !showAnalysis;
                updateAnalysisButton();
                localStorage.setItem('showAnalysis', showAnalysis);
                renderChatHistory();
                menu.classList.remove('open');
            });
            
            teachChatbotBtn.addEventListener('click', function() {
                learnChoiceModal.classList.add('open');
                menu.classList.remove('open');
            });
            
            // Keuze knoppen
            singleQuestionBtn.addEventListener('click', function() {
                learnChoiceModal.classList.remove('open');
                singleQuestionModal.classList.add('open');
                document.getElementById('teach-question').value = '';
                document.getElementById('teach-answer').value = '';
            });
            
            multipleQuestionsBtn.addEventListener('click', function() {
                learnChoiceModal.classList.remove('open');
                multipleQuestionsModal.classList.add('open');
                document.getElementById('multiple-qa').value = '';
            });
            
            importTxtBtn.addEventListener('click', function() {
                learnChoiceModal.classList.remove('open');
                importTxtModal.classList.add('open');
                fileInput.value = '';
                fileContent.style.display = 'none';
                saveImport.disabled = true;
            });
            
            loadGithubBtn.addEventListener('click', function() {
                learnChoiceModal.classList.remove('open');
                githubModal.classList.add('open');
                githubUrlInput.value = "https://raw.githubusercontent.com/jimisdebest/ai/main/reacties.txt";
                githubStatus.innerHTML = '';
                loadGithub.disabled = false;
            });
            
            // Annuleer knoppen
            cancelLearnChoice.addEventListener('click', function() {
                learnChoiceModal.classList.remove('open');
            });
            
            cancelSingle.addEventListener('click', function() {
                singleQuestionModal.classList.remove('open');
            });
            
            cancelMultiple.addEventListener('click', function() {
                multipleQuestionsModal.classList.remove('open');
            });
            
            cancelImport.addEventListener('click', function() {
                importTxtModal.classList.remove('open');
            });
            
            cancelGithub.addEventListener('click', function() {
                githubModal.classList.remove('open');
            });
            
            cancelSaveChat.addEventListener('click', function() {
                saveChatModal.classList.remove('open');
            });
            
            // Opslaan knoppen
            saveSingle.addEventListener('click', function() {
                const question = document.getElementById('teach-question').value.trim();
                const answer = document.getElementById('teach-answer').value.trim();
                
                if (question && answer) {
                    saveToKnowledgeBase(question, answer);
                    singleQuestionModal.classList.remove('open');
                    overlay.classList.remove('open');
                } else {
                    alert('Vul zowel een vraag als een antwoord in.');
                }
            });
            
            saveMultiple.addEventListener('click', function() {
                const multipleText = document.getElementById('multiple-qa').value.trim();
                
                if (multipleText) {
                    const multipleQA = parseMultipleQA(multipleText);
                    let savedCount = 0;
                    
                    multipleQA.forEach(qa => {
                        saveToKnowledgeBase(qa.question, qa.answer);
                        savedCount++;
                    });
                    
                    multipleQuestionsModal.classList.remove('open');
                    overlay.classList.remove('open');
                    
                    addMessageToChat(`Ik heb ${savedCount} nieuwe vraag-antwoord combinatie(s) geleerd!`, 'bot');
                    chats[currentChatId].messages.push({
                        message: `Ik heb ${savedCount} nieuwe vraag-antwoord combinatie(s) geleerd!`,
                        sender: 'bot',
                        timestamp: new Date().toISOString()
                    });
                    
                    localStorage.setItem('chats', JSON.stringify(chats));
                } else {
                    alert('Voer vraag-antwoord paren in.');
                }
            });
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        currentFileContent = e.target.result;
                        filePreview.textContent = currentFileContent;
                        fileContent.style.display = 'block';
                        saveImport.disabled = false;
                    };
                    reader.readAsText(file);
                }
            });
            
            saveImport.addEventListener('click', function() {
                if (currentFileContent) {
                    const result = importFromFile(currentFileContent);
                    importTxtModal.classList.remove('open');
                    overlay.classList.remove('open');
                    
                    addMessageToChat(`Import voltooid! ${result.importedCount} nieuwe reacties toegevoegd, ${result.updatedCount} reacties bijgewerkt.`, 'bot');
                    chats[currentChatId].messages.push({
                        message: `Import voltooid! ${result.importedCount} nieuwe reacties toegevoegd, ${result.updatedCount} reacties bijgewerkt.`,
                        sender: 'bot',
                        timestamp: new Date().toISOString()
                    });
                    
                    localStorage.setItem('chats', JSON.stringify(chats));
                }
            });
            
            loadGithub.addEventListener('click', function() {
                const url = githubUrlInput.value.trim();
                if (url) {
                    loadFromGithub(url);
                } else {
                    githubStatus.innerHTML = '<div style="color: red;">‚ùå Voer een geldige GitHub URL in.</div>';
                }
            });
            
            saveChat.addEventListener('click', function() {
                saveCurrentChat();
            });
            
            sendButton.addEventListener('click', function() {
                const message = chatInput.value.trim();
                if (message) {
                    processUserMessage(message);
                    chatInput.value = '';
                    
                    sendButton.classList.add('send-animation');
                    setTimeout(() => {
                        sendButton.classList.remove('send-animation');
                    }, 300);
                }
            });
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendButton.click();
                }
            });
        });
    </script>
</body>
</html>
